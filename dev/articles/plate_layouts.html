<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Plate layouts • designit</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Plate layouts">
<meta property="og:description" content="designit">
<meta property="og:image" content="https://bedapub.github.io/designit/logo.svg">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">designit</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.4.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/NCS22_talk.html">designit: a flexible engine to generate experiment layouts</a>
    </li>
    <li>
      <a href="../articles/basic_examples.html">Basic example</a>
    </li>
    <li>
      <a href="../articles/custom_shuffle.html">Using custom shuffle schedule</a>
    </li>
    <li>
      <a href="../articles/invivo_study_design.html">In-vivo study design</a>
    </li>
    <li>
      <a href="../articles/nested_dimensions_examples.html">Nested dimension example</a>
    </li>
    <li>
      <a href="../articles/optimizer_examples.html">Optimizer examples</a>
    </li>
    <li>
      <a href="../articles/osat.html">OSAT and scoring functions</a>
    </li>
    <li>
      <a href="../articles/plate_layouts.html">Plate layouts</a>
    </li>
    <li>
      <a href="../articles/plate_scoring_examples.html">Plate scoring examples</a>
    </li>
    <li>
      <a href="../articles/shuffling_with_constraints.html">Shuffling with constraints</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/BEDApub/designit" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Plate layouts</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/BEDApub/designit/tree/main/vignettes/plate_layouts.Rmd" class="external-link"><code>vignettes/plate_layouts.Rmd</code></a></small>
      <div class="hidden name"><code>plate_layouts.Rmd</code></div>

    </div>

    
    
<pre><code><span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.4</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.4.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.0</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.1     </span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>Distributing samples to wells plates for experimental procedures is a
very common task. In the following we use a data set of longitudinal
subject samples that are to be spread across several n-well plates,
balanced for treatment group and time point
<code>longitudinal_subject_samples</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"longitudinal_subject_samples"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">longitudinal_subject_samples</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 9</span></span></span>
<span><span class="co">#&gt;   SampleID SampleType SubjectID Group  Week Sex     Age   BMI SamplesPerSubject</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> P01W1    Sample     P01       1         1 F        71  28.1                 7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> P01W4    Sample     P01       1         4 F        71  28.1                 7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> P01W6    Sample     P01       1         6 F        71  28.1                 7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> P01W10   Sample     P01       1        10 F        71  28.1                 7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> P01W14   Sample     P01       1        14 F        71  28.1                 7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> P01W18   Sample     P01       1        18 F        71  28.1                 7</span></span></code></pre></div>
<p>In the fist example we’ll use a subset of samples to demonstrate the
process.</p>
<ul>
<li>We have 33 subject with each 2 samples.</li>
<li>Factors we want to balance are treatment group and Sex.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">longitudinal_subject_samples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">Group</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="va">Week</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SampleID</span>, <span class="va">SubjectID</span>, <span class="va">Group</span>, <span class="va">Sex</span>, <span class="va">Week</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for simplicity: remove two subjects that don't have both visits</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">SubjectID</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="layout-optimization-in-one-go">Layout optimization in one go<a class="anchor" aria-label="anchor" href="#layout-optimization-in-one-go"></a>
</h2>
<p>For placing samples on plates and optimizing across plate
distribution of factors as well as the within plate spacial
distribution, the <code>multi_plate_wrapper()</code> function can be
used. It focuses first on assigning samples to plates and then optimizes
the layout within plates.</p>
<p>To place all 66 samples on 24-well plates we create a
<code>batch_container</code> with 3 plates</p>
<p>We do the initial assignment of sample to plates and plot it</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/BatchContainer.html">BatchContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"plate"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"row"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"col"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>,</span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/assign_in_order.html">assign_in_order</a></span><span class="op">(</span><span class="va">bc</span>, <span class="va">dat</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="qeayjdrzqo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qeayjdrzqo .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qeayjdrzqo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#qeayjdrzqo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qeayjdrzqo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qeayjdrzqo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qeayjdrzqo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qeayjdrzqo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qeayjdrzqo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qeayjdrzqo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qeayjdrzqo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#qeayjdrzqo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qeayjdrzqo .gt_from_md > :first-child {
  margin-top: 0;
}

#qeayjdrzqo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qeayjdrzqo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qeayjdrzqo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#qeayjdrzqo .gt_row_group_first td {
  border-top-width: 2px;
}

#qeayjdrzqo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#qeayjdrzqo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#qeayjdrzqo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qeayjdrzqo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qeayjdrzqo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qeayjdrzqo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qeayjdrzqo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#qeayjdrzqo .gt_left {
  text-align: left;
}

#qeayjdrzqo .gt_center {
  text-align: center;
}

#qeayjdrzqo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qeayjdrzqo .gt_font_normal {
  font-weight: normal;
}

#qeayjdrzqo .gt_font_bold {
  font-weight: bold;
}

#qeayjdrzqo .gt_font_italic {
  font-style: italic;
}

#qeayjdrzqo .gt_super {
  font-size: 65%;
}

#qeayjdrzqo .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#qeayjdrzqo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#qeayjdrzqo .gt_indent_1 {
  text-indent: 5px;
}

#qeayjdrzqo .gt_indent_2 {
  text-indent: 10px;
}

#qeayjdrzqo .gt_indent_3 {
  text-indent: 15px;
}

#qeayjdrzqo .gt_indent_4 {
  text-indent: 20px;
}

#qeayjdrzqo .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="plate">plate</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="row">row</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="col">col</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="SampleID">SampleID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="SubjectID">SubjectID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Group">Group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Sex">Sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Week">Week</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="plate" class="gt_row gt_right">1</td>
<td headers="row" class="gt_row gt_right">1</td>
<td headers="col" class="gt_row gt_right">1</td>
<td headers="SampleID" class="gt_row gt_left">P01W1</td>
<td headers="SubjectID" class="gt_row gt_left">P01</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Week" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="plate" class="gt_row gt_right">1</td>
<td headers="row" class="gt_row gt_right">1</td>
<td headers="col" class="gt_row gt_right">2</td>
<td headers="SampleID" class="gt_row gt_left">P01W4</td>
<td headers="SubjectID" class="gt_row gt_left">P01</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Week" class="gt_row gt_right">4</td>
</tr>
<tr>
<td headers="plate" class="gt_row gt_right">1</td>
<td headers="row" class="gt_row gt_right">1</td>
<td headers="col" class="gt_row gt_right">3</td>
<td headers="SampleID" class="gt_row gt_left">P02W1</td>
<td headers="SubjectID" class="gt_row gt_left">P02</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Week" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="plate" class="gt_row gt_right">1</td>
<td headers="row" class="gt_row gt_right">1</td>
<td headers="col" class="gt_row gt_right">4</td>
<td headers="SampleID" class="gt_row gt_left">P02W4</td>
<td headers="SubjectID" class="gt_row gt_left">P02</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Week" class="gt_row gt_right">4</td>
</tr>
<tr>
<td headers="plate" class="gt_row gt_right">1</td>
<td headers="row" class="gt_row gt_right">1</td>
<td headers="col" class="gt_row gt_right">5</td>
<td headers="SampleID" class="gt_row gt_left">P03W1</td>
<td headers="SubjectID" class="gt_row gt_left">P03</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Week" class="gt_row gt_right">1</td>
</tr>
<tr>
<td headers="plate" class="gt_row gt_right">1</td>
<td headers="row" class="gt_row gt_right">1</td>
<td headers="col" class="gt_row gt_right">6</td>
<td headers="SampleID" class="gt_row gt_left">P03W4</td>
<td headers="SubjectID" class="gt_row gt_left">P03</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Week" class="gt_row gt_right">4</td>
</tr>
</tbody>
</table>
</div>
<p>We can view the initial assignment with <code>plot_plate</code></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Group</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Group"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Sex"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-5-1.png" width="480"></p>
<p>For optimization <code><a href="../reference/optimize_multi_plate_design.html">optimize_multi_plate_design()</a></code>
iteratively calls <code><a href="../reference/optimize_design.html">optimize_design()</a></code> for different steps of
the experiment. For across plate optimization osat scoring is used. For
within plate optimization spatial scoreing is used. The order of the
factors indicate their relative importance. In this case we prioritize
Group over Sex.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traces</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_multi_plate_design.html">optimize_multi_plate_design</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>  across_plates_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="st">"Sex"</span><span class="op">)</span>,</span>
<span>  within_plate_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span>,</span>
<span>  plate <span class="op">=</span> <span class="st">"plate"</span>,</span>
<span>  row <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"col"</span>,</span>
<span>  n_shuffle <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">700</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in osat_score(bc, batch_vars = batch_vars, feature_vars = feature_vars,</span></span>
<span><span class="co">#&gt; : NAs in features / batch columns; they will be excluded from scoring</span></span>
<span></span>
<span><span class="co">#&gt; Warning in osat_score(bc, batch_vars = batch_vars, feature_vars = feature_vars,</span></span>
<span><span class="co">#&gt; : NAs in features / batch columns; they will be excluded from scoring</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Group</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Group"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Sex"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-7-1.png" width="480"></p>
<p>We can look at the trace objects for each internal
<code>optimize_design</code> run, returned from the wrapper
function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span><span class="va">traces</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>include_aggregated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $osat_across_plates</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-8-1.png" width="288"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_1</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-8-2.png" width="288"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_2</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-8-3.png" width="288"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_3</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-8-4.png" width="288"></p>
<div class="section level3">
<h3 id="plate-scoring">Plate scoring<a class="anchor" aria-label="anchor" href="#plate-scoring"></a>
</h3>
<p>Note that internally the wrapper function sets up plate specific
scoring functions that could manually be set up in the following
way.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bc</span><span class="op">$</span><span class="va">scoring_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  Group <span class="op">=</span> <span class="fu"><a href="../reference/mk_plate_scoring_functions.html">mk_plate_scoring_functions</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>    plate <span class="op">=</span> <span class="st">"plate"</span>, row <span class="op">=</span> <span class="st">"row"</span>, column <span class="op">=</span> <span class="st">"col"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"Group"</span>, penalize_lines <span class="op">=</span> <span class="st">"hard"</span></span>
<span>  <span class="op">)</span>,</span>
<span>  Sex <span class="op">=</span> <span class="fu"><a href="../reference/mk_plate_scoring_functions.html">mk_plate_scoring_functions</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>    plate <span class="op">=</span> <span class="st">"plate"</span>, row <span class="op">=</span> <span class="st">"row"</span>, column <span class="op">=</span> <span class="st">"col"</span>,</span>
<span>    group <span class="op">=</span> <span class="st">"Sex"</span>, penalize_lines <span class="op">=</span> <span class="st">"hard"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>For more information on customized plate scoring see vignette
<code>Plate scoring examples</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="two-step-approach">Two step approach<a class="anchor" aria-label="anchor" href="#two-step-approach"></a>
</h2>
<p>Sometimes layout requests can be more complicated. Assume we want to
keep the two samples of a subject on the same 24 well plate.</p>
<p>Now we need to customize across plate optimization more so we need to
split the process into two steps.</p>
<div class="section level3">
<h3 id="step-1-subjects-to-plates">Step 1: Subjects to plates<a class="anchor" aria-label="anchor" href="#step-1-subjects-to-plates"></a>
</h3>
<p>There are 31 subjects with each 2 time points, i.e. we need ~ 11
subjects per plate and want to balance by treatment, sex.</p>
<p>First we create a batch container with 3 batches that each fit 11
subjects i.e. have 11 virtual <code>locations</code>.</p>
<p>For layout scoring we use OSAT score on <code>Group</code> and
<code>Sex</code> variables.</p>
<p>Then we assign the samples randomly to the batches and look at their
initial distribution.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">17</span><span class="op">)</span> <span class="co"># gives `bad` random assignment</span></span>
<span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/BatchContainer.html">BatchContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"batch"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"location"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bc</span><span class="op">$</span><span class="va">scoring_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="../reference/osat_score_generator.html">osat_score_generator</a></span><span class="op">(</span>batch_vars <span class="op">=</span> <span class="st">"batch"</span>, feature_vars <span class="op">=</span> <span class="st">"Group"</span><span class="op">)</span>,</span>
<span>  sex <span class="op">=</span> <span class="fu"><a href="../reference/osat_score_generator.html">osat_score_generator</a></span><span class="op">(</span>batch_vars <span class="op">=</span> <span class="st">"batch"</span>, feature_vars <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/assign_random.html">assign_random</a></span><span class="op">(</span></span>
<span>  <span class="va">bc</span>,</span>
<span>  <span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SubjectID</span>, <span class="va">Group</span>, <span class="va">Sex</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="dezuqsvkwv" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#dezuqsvkwv .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#dezuqsvkwv .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dezuqsvkwv .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#dezuqsvkwv .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#dezuqsvkwv .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#dezuqsvkwv .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dezuqsvkwv .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#dezuqsvkwv .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#dezuqsvkwv .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#dezuqsvkwv .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#dezuqsvkwv .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#dezuqsvkwv .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#dezuqsvkwv .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#dezuqsvkwv .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#dezuqsvkwv .gt_from_md > :first-child {
  margin-top: 0;
}

#dezuqsvkwv .gt_from_md > :last-child {
  margin-bottom: 0;
}

#dezuqsvkwv .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#dezuqsvkwv .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#dezuqsvkwv .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#dezuqsvkwv .gt_row_group_first td {
  border-top-width: 2px;
}

#dezuqsvkwv .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dezuqsvkwv .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#dezuqsvkwv .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#dezuqsvkwv .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dezuqsvkwv .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#dezuqsvkwv .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#dezuqsvkwv .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#dezuqsvkwv .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#dezuqsvkwv .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dezuqsvkwv .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dezuqsvkwv .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#dezuqsvkwv .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#dezuqsvkwv .gt_left {
  text-align: left;
}

#dezuqsvkwv .gt_center {
  text-align: center;
}

#dezuqsvkwv .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#dezuqsvkwv .gt_font_normal {
  font-weight: normal;
}

#dezuqsvkwv .gt_font_bold {
  font-weight: bold;
}

#dezuqsvkwv .gt_font_italic {
  font-style: italic;
}

#dezuqsvkwv .gt_super {
  font-size: 65%;
}

#dezuqsvkwv .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#dezuqsvkwv .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#dezuqsvkwv .gt_indent_1 {
  text-indent: 5px;
}

#dezuqsvkwv .gt_indent_2 {
  text-indent: 10px;
}

#dezuqsvkwv .gt_indent_3 {
  text-indent: 15px;
}

#dezuqsvkwv .gt_indent_4 {
  text-indent: 20px;
}

#dezuqsvkwv .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="batch">batch</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="location">location</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="SubjectID">SubjectID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Group">Group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Sex">Sex</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="batch" class="gt_row gt_right">1</td>
<td headers="location" class="gt_row gt_right">1</td>
<td headers="SubjectID" class="gt_row gt_left">NA</td>
<td headers="Group" class="gt_row gt_right">NA</td>
<td headers="Sex" class="gt_row gt_left">NA</td>
</tr>
<tr>
<td headers="batch" class="gt_row gt_right">1</td>
<td headers="location" class="gt_row gt_right">2</td>
<td headers="SubjectID" class="gt_row gt_left">P32</td>
<td headers="Group" class="gt_row gt_right">5</td>
<td headers="Sex" class="gt_row gt_left">M</td>
</tr>
<tr>
<td headers="batch" class="gt_row gt_right">1</td>
<td headers="location" class="gt_row gt_right">3</td>
<td headers="SubjectID" class="gt_row gt_left">P10</td>
<td headers="Group" class="gt_row gt_right">3</td>
<td headers="Sex" class="gt_row gt_left">F</td>
</tr>
<tr>
<td headers="batch" class="gt_row gt_right">1</td>
<td headers="location" class="gt_row gt_right">4</td>
<td headers="SubjectID" class="gt_row gt_left">P26</td>
<td headers="Group" class="gt_row gt_right">3</td>
<td headers="Sex" class="gt_row gt_left">M</td>
</tr>
<tr>
<td headers="batch" class="gt_row gt_right">1</td>
<td headers="location" class="gt_row gt_right">5</td>
<td headers="SubjectID" class="gt_row gt_left">P17</td>
<td headers="Group" class="gt_row gt_right">5</td>
<td headers="Sex" class="gt_row gt_left">M</td>
</tr>
<tr>
<td headers="batch" class="gt_row gt_right">1</td>
<td headers="location" class="gt_row gt_right">6</td>
<td headers="SubjectID" class="gt_row gt_left">P07</td>
<td headers="Group" class="gt_row gt_right">2</td>
<td headers="Sex" class="gt_row gt_left">F</td>
</tr>
</tbody>
</table>
</div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch</span>, fill <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-11-1.png" width="528"></p>
<p>Optimizing the layout with <code><a href="../reference/optimize_design.html">optimize_design()</a></code></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_design.html">optimize_design</a></span><span class="op">(</span></span>
<span>  <span class="va">bc</span>,</span>
<span>  n_shuffle <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  acceptance_func <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/accept_leftmost_improvement.html">accept_leftmost_improvement</a></span><span class="op">(</span><span class="va">...</span>, tolerance <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in osat_score(bc, batch_vars = batch_vars, feature_vars = feature_vars,</span></span>
<span><span class="co">#&gt; : NAs in features / batch columns; they will be excluded from scoring</span></span>
<span></span>
<span><span class="co">#&gt; Warning in osat_score(bc, batch_vars = batch_vars, feature_vars = feature_vars,</span></span>
<span><span class="co">#&gt; : NAs in features / batch columns; they will be excluded from scoring</span></span></code></pre></div>
<p>After optimization the group and sex of samples are equally
distributed across all plates. The lower right panel shows the
optimization trace of the scores.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">batch</span>, fill <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">trace</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>include_aggregated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  ncol <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-13-1.png" width="768"></p>
</div>
<div class="section level3">
<h3 id="step-2-within-plate-sample-distribution">Step 2: Within plate sample distribution<a class="anchor" aria-label="anchor" href="#step-2-within-plate-sample-distribution"></a>
</h3>
<p>Using the result from step 1 we now optimize the layout within
plates. For this we still need to add empty wells to each batch and
assign the pre-allocated sample sheet in the right way to the new batch
container.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">SubjectID</span>, <span class="va">batch</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(SubjectID)`</span></span>
<span></span>
<span><span class="co"># add empty wells depending on how full the batch plate is</span></span>
<span><span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    SubjectID <span class="op">=</span> <span class="st">"empty"</span>,</span>
<span>    SampleID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"empty"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="fl">24</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">dat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    batch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">24</span> <span class="op">-</span> <span class="op">(</span><span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/BatchContainer.html">BatchContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"plate"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"row"</span> <span class="op">=</span> <span class="fl">4</span>, <span class="st">"col"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># initial assignment such that the original plate assigned stays the same</span></span>
<span><span class="fu"><a href="../reference/assign_in_order.html">assign_in_order</a></span><span class="op">(</span></span>
<span>  <span class="va">bc</span>,</span>
<span>  <span class="va">dat</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">batch</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Group</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Group"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Sex"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-14-1.png" width="480"></p>
<p>As we have already assigned samples to plates, the across plate
optimization can be skipped in the wrapper. For distributing samples
within each plate, we use variables Group and Sex again. The order of
the factors indicate their relative importance.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traces</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_multi_plate_design.html">optimize_multi_plate_design</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>  within_plate_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="st">"Sex"</span><span class="op">)</span>,</span>
<span>  plate <span class="op">=</span> <span class="st">"plate"</span>,</span>
<span>  row <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"col"</span>,</span>
<span>  n_shuffle <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Group</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Final layout by Group"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Final layout by Sex"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-16-1.png" width="480"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span><span class="va">traces</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>include_aggregated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $within_plate_1</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-17-1.png" width="288"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_2</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-17-2.png" width="288"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_3</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-17-3.png" width="288"></p>
</div>
</div>
<div class="section level2">
<h2 id="full-dataset">Full dataset<a class="anchor" aria-label="anchor" href="#full-dataset"></a>
</h2>
<p>In the following we use the full data set of longitudinal subject
samples that are to be spread across several n-well plates, balanced for
treatment group and time point
<code>longitudinal_subject_samples</code>.</p>
<p>In addition to the normal samples there are also controls to be
placed on each plate. These are added after the sample batching
step.</p>
<p>For accommodation of samples to plates there are the following
control samples available</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">longitudinal_subject_samples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SampleType</span> <span class="op">!=</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">SampleType</span>, <span class="va">Group</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="exozcubrmo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#exozcubrmo .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#exozcubrmo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#exozcubrmo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#exozcubrmo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#exozcubrmo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#exozcubrmo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#exozcubrmo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#exozcubrmo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#exozcubrmo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#exozcubrmo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#exozcubrmo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#exozcubrmo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#exozcubrmo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#exozcubrmo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#exozcubrmo .gt_from_md > :first-child {
  margin-top: 0;
}

#exozcubrmo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#exozcubrmo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#exozcubrmo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#exozcubrmo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#exozcubrmo .gt_row_group_first td {
  border-top-width: 2px;
}

#exozcubrmo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#exozcubrmo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#exozcubrmo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#exozcubrmo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#exozcubrmo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#exozcubrmo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#exozcubrmo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#exozcubrmo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#exozcubrmo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#exozcubrmo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#exozcubrmo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#exozcubrmo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#exozcubrmo .gt_left {
  text-align: left;
}

#exozcubrmo .gt_center {
  text-align: center;
}

#exozcubrmo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#exozcubrmo .gt_font_normal {
  font-weight: normal;
}

#exozcubrmo .gt_font_bold {
  font-weight: bold;
}

#exozcubrmo .gt_font_italic {
  font-style: italic;
}

#exozcubrmo .gt_super {
  font-size: 65%;
}

#exozcubrmo .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#exozcubrmo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#exozcubrmo .gt_indent_1 {
  text-indent: 5px;
}

#exozcubrmo .gt_indent_2 {
  text-indent: 10px;
}

#exozcubrmo .gt_indent_3 {
  text-indent: 15px;
}

#exozcubrmo .gt_indent_4 {
  text-indent: 20px;
}

#exozcubrmo .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1" scope="col" id="SampleType">SampleType</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Group">Group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="n">n</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="SampleType" class="gt_row gt_center">Control</td>
<td headers="Group" class="gt_row gt_left">Pool</td>
<td headers="n" class="gt_row gt_right">6</td>
</tr>
<tr>
<td headers="SampleType" class="gt_row gt_center">Standard</td>
<td headers="Group" class="gt_row gt_left">SpikeIn</td>
<td headers="n" class="gt_row gt_right">15</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="step-1-batching">Step 1: Batching<a class="anchor" aria-label="anchor" href="#step-1-batching"></a>
</h3>
<p>Again we want to keep all samples of a subject on the same plate. A
first step could be grouping subjects into 3 batches blocking by
treatment, sex and age. There are 34 subjects with each 3 - 8 time
points, i.e. we need ~ 11 subjects per plate.</p>
<p>We first create a ‘subjects’ dataset.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get subject data for batching</span></span>
<span><span class="va">subjects</span> <span class="op">&lt;-</span> <span class="va">longitudinal_subject_samples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">SampleType</span> <span class="op">==</span> <span class="st">"Sample"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">SubjectID</span>, <span class="va">Group</span>, <span class="va">Sex</span>, <span class="va">Age</span>, name <span class="op">=</span> <span class="st">"nTimePoints"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">subjects</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">nTimePoints</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/gt.html" class="external-link">gt</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">gt</span><span class="fu">::</span><span class="fu"><a href="https://gt.rstudio.com/reference/tab_options.html" class="external-link">tab_options</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div id="fbqeqjdgdw" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fbqeqjdgdw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fbqeqjdgdw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fbqeqjdgdw .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#fbqeqjdgdw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fbqeqjdgdw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fbqeqjdgdw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbqeqjdgdw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fbqeqjdgdw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fbqeqjdgdw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fbqeqjdgdw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fbqeqjdgdw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fbqeqjdgdw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fbqeqjdgdw .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#fbqeqjdgdw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fbqeqjdgdw .gt_from_md > :first-child {
  margin-top: 0;
}

#fbqeqjdgdw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fbqeqjdgdw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fbqeqjdgdw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#fbqeqjdgdw .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#fbqeqjdgdw .gt_row_group_first td {
  border-top-width: 2px;
}

#fbqeqjdgdw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbqeqjdgdw .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#fbqeqjdgdw .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#fbqeqjdgdw .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbqeqjdgdw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbqeqjdgdw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fbqeqjdgdw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fbqeqjdgdw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fbqeqjdgdw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fbqeqjdgdw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-left: 4px;
  padding-right: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbqeqjdgdw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fbqeqjdgdw .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#fbqeqjdgdw .gt_left {
  text-align: left;
}

#fbqeqjdgdw .gt_center {
  text-align: center;
}

#fbqeqjdgdw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fbqeqjdgdw .gt_font_normal {
  font-weight: normal;
}

#fbqeqjdgdw .gt_font_bold {
  font-weight: bold;
}

#fbqeqjdgdw .gt_font_italic {
  font-style: italic;
}

#fbqeqjdgdw .gt_super {
  font-size: 65%;
}

#fbqeqjdgdw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 75%;
  vertical-align: 0.4em;
}

#fbqeqjdgdw .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#fbqeqjdgdw .gt_indent_1 {
  text-indent: 5px;
}

#fbqeqjdgdw .gt_indent_2 {
  text-indent: 10px;
}

#fbqeqjdgdw .gt_indent_3 {
  text-indent: 15px;
}

#fbqeqjdgdw .gt_indent_4 {
  text-indent: 20px;
}

#fbqeqjdgdw .gt_indent_5 {
  text-indent: 25px;
}
</style>
<table class="table gt_table">
<thead class="gt_col_headings"><tr>
<th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="SubjectID">SubjectID</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Group">Group</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1" scope="col" id="Sex">Sex</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1" scope="col" id="Age">Age</th>
    </tr></thead>
<tbody class="gt_table_body">
<tr>
<td headers="SubjectID" class="gt_row gt_left">P01</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Age" class="gt_row gt_right">71</td>
</tr>
<tr>
<td headers="SubjectID" class="gt_row gt_left">P02</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Age" class="gt_row gt_right">74</td>
</tr>
<tr>
<td headers="SubjectID" class="gt_row gt_left">P03</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Age" class="gt_row gt_right">76</td>
</tr>
<tr>
<td headers="SubjectID" class="gt_row gt_left">P04</td>
<td headers="Group" class="gt_row gt_right">1</td>
<td headers="Sex" class="gt_row gt_left">F</td>
<td headers="Age" class="gt_row gt_right">83</td>
</tr>
<tr>
<td headers="SubjectID" class="gt_row gt_left">P05</td>
<td headers="Group" class="gt_row gt_right">2</td>
<td headers="Sex" class="gt_row gt_left">M</td>
<td headers="Age" class="gt_row gt_right">79</td>
</tr>
</tbody>
</table>
</div>
<p>Then we create a batch container for the samples with 3 batches
called <code>plate</code> that each fit 11 subjects i.e. have 11 virtual
<code>locations</code>.</p>
<p>For layout scoring we use OSAT score on <code>Group</code> and
<code>Sex</code> variables. We initially assign the samples randomly to
the batches and check the layout.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/BatchContainer.html">BatchContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"plate"</span> <span class="op">=</span> <span class="fl">3</span>, <span class="st">"locations"</span> <span class="op">=</span> <span class="fl">11</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">bc</span><span class="op">$</span><span class="va">scoring_f</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  group <span class="op">=</span> <span class="fu"><a href="../reference/osat_score_generator.html">osat_score_generator</a></span><span class="op">(</span>batch_vars <span class="op">=</span> <span class="st">"plate"</span>, feature_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  sex <span class="op">=</span> <span class="fu"><a href="../reference/osat_score_generator.html">osat_score_generator</a></span><span class="op">(</span>batch_vars <span class="op">=</span> <span class="st">"plate"</span>, feature_vars <span class="op">=</span> <span class="st">"Sex"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/assign_random.html">assign_random</a></span><span class="op">(</span><span class="va">bc</span>, <span class="va">subjects</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plate</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plate</span>, fill <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">Age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-21-1.png" width="768"></p>
<p>Optimizing the layout with <code><a href="../reference/optimize_design.html">optimize_design()</a></code></p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">trace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_design.html">optimize_design</a></span><span class="op">(</span></span>
<span>  <span class="va">bc</span>,</span>
<span>  n_shuffle <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  acceptance_func <span class="op">=</span> <span class="op">~</span> <span class="fu"><a href="../reference/accept_leftmost_improvement.html">accept_leftmost_improvement</a></span><span class="op">(</span><span class="va">...</span>, tolerance <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">150</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>After optimization the group and sex of samples are equally
distributed across all plates. The lower right panel shows the
optimization trace of the scores.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plate</span>, fill <span class="op">=</span> <span class="va">Group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">plate</span>, fill <span class="op">=</span> <span class="va">Sex</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_bar</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>y <span class="op">=</span> <span class="st">"subject count"</span><span class="op">)</span>,</span>
<span>    <span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">Age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html" class="external-link">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    <span class="va">trace</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>include_aggregated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-23-1.png" width="528"></p>
</div>
<div class="section level3">
<h3 id="step-2-within-plate-sample-distribution-1">Step 2: Within plate sample distribution<a class="anchor" aria-label="anchor" href="#step-2-within-plate-sample-distribution-1"></a>
</h3>
<p>We start here by creating the batch container for all samples and
making an initial assignment. Note there will be empty positions on the
plates which we have to add before we assign the samples to the batch
container <em>in order</em>.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">samples_with_plate</span> <span class="op">&lt;-</span> <span class="va">longitudinal_subject_samples</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">locations</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>plate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">SampleType</span> <span class="op">==</span> <span class="st">"Sample"</span>, <span class="va">plate</span>, <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span><span class="va">SampleID</span>, <span class="st">".$"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(SubjectID, Group, Sex, Age)`</span></span>
<span></span>
<span><span class="co"># not all plates have same amount of samples</span></span>
<span><span class="va">samples_with_plate</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   plate     n</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1        77</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 2        80</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 3        73</span></span>
<span></span>
<span><span class="co"># add empty wells depending on how full the batch plate is</span></span>
<span><span class="co"># column 11 and 12 are left empty: 96 - 16 = 80 samples per plate</span></span>
<span><span class="va">samples_with_plate</span> <span class="op">&lt;-</span> <span class="va">samples_with_plate</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    SubjectID <span class="op">=</span> <span class="st">"empty"</span>,</span>
<span>    SampleID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"empty"</span>, <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="fl">80</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">samples_with_plate</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    plate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">80</span> <span class="op">-</span> <span class="op">(</span><span class="va">samples_with_plate</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="va">.</span><span class="op">$</span><span class="va">n</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># new batch container for step 2</span></span>
<span><span class="va">bc</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/BatchContainer.html">BatchContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>plate <span class="op">=</span> <span class="fl">3</span>, row <span class="op">=</span> <span class="fl">8</span>, col <span class="op">=</span> <span class="fl">12</span><span class="op">)</span>,</span>
<span>  exclude <span class="op">=</span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/expand.html" class="external-link">crossing</a></span><span class="op">(</span>plate <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, row <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">8</span>, col <span class="op">=</span> <span class="fl">11</span><span class="op">:</span><span class="fl">12</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># assign samples in order of plate</span></span>
<span><span class="fu"><a href="../reference/assign_in_order.html">assign_in_order</a></span><span class="op">(</span></span>
<span>  <span class="va">bc</span>,</span>
<span>  <span class="va">samples_with_plate</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">plate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>orig_plate <span class="op">=</span> <span class="va">plate</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check if plate assignment is still correct</span></span>
<span><span class="va">bc</span><span class="op">$</span><span class="fu">get_samples</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">plate</span> <span class="op">==</span> <span class="va">orig_plate</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; all(plate == orig_plate) </span></span>
<span><span class="co">#&gt;                     TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Group</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Group"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">SubjectID</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by SubjectID"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Initial layout by Sex"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-25-1.png" width="768"></p>
<p>As we have already assigned samples to plates, the across plate
optimization can be skipped in the wrapper. For distributing samples
within each plate, we use variables Group and Sex again. The order of
the factors indicate their relative importance.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">traces</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optimize_multi_plate_design.html">optimize_multi_plate_design</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>  within_plate_variables <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group"</span>, <span class="st">"SubjectID"</span>, <span class="st">"Sex"</span><span class="op">)</span>,</span>
<span>  plate <span class="op">=</span> <span class="st">"plate"</span>,</span>
<span>  row <span class="op">=</span> <span class="st">"row"</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"col"</span>,</span>
<span>  n_shuffle <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  max_iter <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cowplot</span><span class="fu">::</span><span class="fu"><a href="https://wilkelab.org/cowplot/reference/plot_grid.html" class="external-link">plot_grid</a></span><span class="op">(</span></span>
<span>  plotlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Group</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Final layout by Group"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span></span>
<span>        <span class="va">SubjectID</span>, title <span class="op">=</span> <span class="st">"Final layout by SubjectID"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.key.size <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grid/unit.html" class="external-link">unit</a></span><span class="op">(</span><span class="fl">.25</span>, <span class="st">"cm"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="../reference/plot_plate.html">plot_plate</a></span><span class="op">(</span><span class="va">bc</span>,</span>
<span>      plate <span class="op">=</span> <span class="va">plate</span>, row <span class="op">=</span> <span class="va">row</span>, column <span class="op">=</span> <span class="va">col</span>, .color <span class="op">=</span> <span class="va">Sex</span>,</span>
<span>      title <span class="op">=</span> <span class="st">"Final layout by Sex"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  nrow <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-27-1.png" width="768"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/imap.html" class="external-link">imap</a></span><span class="op">(</span><span class="va">traces</span>, <span class="op">~</span> <span class="va">.x</span><span class="op">$</span><span class="fu">plot</span><span class="op">(</span>include_aggregated <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="va">.y</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $within_plate_1</span></span></code></pre></div>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-28-1.png" width="480"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_2</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-28-2.png" width="480"></p>
<pre><code><span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $within_plate_3</span></span></code></pre>
<p><img src="plate_layouts_files/figure-html/unnamed-chunk-28-3.png" width="480"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Iakov I. Davydov, Juliane Siebourg-Polster, Guido Steiner, Balazs Banfai.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
